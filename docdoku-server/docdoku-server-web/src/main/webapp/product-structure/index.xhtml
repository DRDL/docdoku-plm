<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:em="http://java.sun.com/jsf/composite/default"
        >
<ui:composition template="/WEB-INF/templates/moduleTemplate.xhtml">
    <ui:define name="title">
        <f:loadBundle var="i18nPS" basename="com.docdoku.server.localization.explorer_resource"/>
        #{i18nPS['title']} - #{workspaceID} - #{productID}
    </ui:define>
    <ui:define name="styles">
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/jquery.treeview.css"/>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/modules/jquery.nouislider.css"/>

        <link rel="stylesheet/less" type="text/css" href="#{request.contextPath}/less/product-structure/style.less"/>
    </ui:define>
    <ui:define name="scripts">

        <script type="text/javascript" src="#{request.contextPath}/js/lib/dat.gui.min.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/modernizr.custom.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/jquery.nouislider.min.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/tween.min.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/three.min.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/BinaryLoader.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/ColladaLoader.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/STLLoader.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/Stats.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/threex.domevent.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/lib/visualization/VisualizationUtils.js"></script>

        <script type="text/javascript" src="#{request.contextPath}/js/product-structure/dmu/controls/TrackballControls.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/product-structure/dmu/controls/PointerLockControls.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/product-structure/dmu/controls/OrbitControls.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/js/product-structure/dmu/controls/TransformControls.js"></script>

        <script type="text/javascript">
            var APP_CONFIG = {
                workspaceId: "${workspaceID}",
                productId: "${productID}",
                login: "${login}",
                sessionId: "${session.id}",
                workspaceAdmin:"${workspaceAdmin}",
                groups: [${groups}],
                contextPath: "#{request.contextPath}"
            };

            var SCENE_INIT = {};

            var isIpad = navigator.userAgent.indexOf("iPad") != -1;

            var sceneManager;

            // Global Namespace for the application
            var App = {
                debug: false,
                instancesManager : null,
                sceneManager : null,
                logLevel: {ALL:-1, DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4,OFF:5},
                logType: {ALL:-1, DEFAULT:0, WORKER:1, WEBSOCKET:2},

                WorkerManagedValues: {
                    maxInstances: 500,
                    maxAngle: Math.PI / 4,
                    maxDist: 100000,
                    minProjectedSize: 0.000001,//100,
                    distanceRating: 0.6,//0.7,
                    angleRating: 0.4,//0.6,//0.5,
                    volRating: 1.0//0.7
                },

                SceneOptions: {
                    grid: false,
                    skeleton: true,
                    zoomSpeed: 1.2,
                    rotateSpeed: 1.0,
                    panSpeed: 0.3,
                    cameraNear: 1,
                    cameraFar: 5E4,
                    defaultCameraPosition: {x: -1000, y: 800, z: 1100},
                    defaultTargetPosition: {x: 0, y: 0, z: 0}
                }

            };
            App.currentLogLevel = App.logType.ERROR;
            App.currentLogType  = App.logType.DEFAULT;
            App.setDebug = function(state, logLevel, logType){
                if(typeof(logLevel)==='undefined') logLevel = App.logType.DEBUG;
                if(typeof(logType)==='undefined') logType = App.logType.DEFAULT;

                App.debug = state;
                App.currentLogLevel=logLevel;
                App.currentLogType=logType;
                if(state){
                    $("body").addClass("debug");
                }else{
                    $("body").removeClass("debug");
                }
            };

            App.log = function(message, logLevel, logType){
                if(typeof(logLevel)==='undefined' ||Â logLevel===App.logLevel.ALL) logLevel = App.logType.INFO;
                if(typeof(logType)==='undefined'|| logType===App.logType.ALL) logType = App.logType.DEFAULT;

                if(logLevel > App.logLevel &amp;&amp; (App.currentLogType===App.logType.ALL || logType===App.logType.DEFAULT || logType===App.currentLogType )){
                    var logPrefix;
                    switch(logType){
                        case App.logType.WEBSOCKET: logPrefix="DocdokuPLM (Websocket):";break;
                        case App.logType.WORKER: logPrefix="DocdokuPLM (Worker):";break;
                        default : logPrefix="DocdokuPLM :";break;
                    }
                    switch(logLevel){
                        case App.logLevel.DEBUG : console.log("[DEBUG] "+logPrefix+" "+message, 'color:#0088cc');break;
                        case App.logLevel.INFO : console.log("[INFO] "+logPrefix+" "+message);break;
                        case App.logLevel.WARN : console.log("[WARN] "+logPrefix+" "+message, 'color:#FAFFBD');break;
                        case App.logLevel.ERROR : console.log("[ERROR] "+logPrefix+" "+message,'color:#FF9933' );break;
                        case App.logLevel.FATAL : console.log("[FATAL] "+logPrefix+" "+message, 'color:#FF0000');break;
                    }
                }
            };

            $(document).ready(function () {

                require.config({
                    baseUrl: "${request.contextPath}/js/product-structure",
                    paths: {
                        "require": "../lib/require/require.min-2.1.2",
                        "text": "../lib/require/text-2.0.3",
                        "i18n": "../lib/require/i18n-2.0.1",
                        "localization": "../localization",
                        "modules": "../modules",
                        "common-objects": "../common-objects",
                        "lib": "../lib"
                    },
                    config: {
                        i18n: {
                            locale: "#{request.locale.language}"
                        }
                    }
                });

                require(["app","router"], function (AppView,Router) {
                    App.appView = new AppView().render();
                    App.router = Router.getInstance();

                    Backbone.history.start();
                });

                require(["modules/user-popover-module/app",
                    "modules/chat-module/app",
                    "modules/webrtc-module/app",
                    "modules/coworkers-access-module/app"
                ]);

                require(["lib/visualization/BufferGeometryUtils"]);

            });
        </script>
    </ui:define>
    <ui:define name="header">
        <em:header id="h" moduleName="product-structure" moduleIcon="fa fa-briefcase" moduleTranslate="#{i18nTemplate['toplinks.product']}" breadcrumbDept="2" />
    </ui:define>
    <ui:define name="content"></ui:define>
</ui:composition>
</html>
